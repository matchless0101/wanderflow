name: Swift Build & Test

on:
  push:
分支: [ "main" ]
  pull_request:
分支: [ "main" ]

jobs:
  build:
    runs-on: macos-latest  # 使用 macOS 环境

    steps:
      # 1. 检出代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 选择合适的 Xcode 版本 (非常重要)
      - name: Select Xcode version
        run: sudo xcode-select -s /Applications/Xcode_15.2.app

      # 3. 缓存 Swift Package Manager 依赖 (大幅提升后续编译速度)
      - name: Cache Swift Packages
        uses: actions/cache@v3
        with:
          path: .build
          key: ${{ runner.os }}-spm-${{ hashFiles('**/Package.resolved') }}
          restore-keys: |
            ${{ runner.os }}-spm-

      # 4. 如果是纯 Swift 库或命令行工具，使用 swift build
      # - name: Build Swift Package
      #   run: swift build

      # 5. 如果是 iOS/macOS App 项目，使用 xcodebuild
      - name: Build and Test App
        run: |
          xcodebuild build-for-testing \
            -scheme "WanderFlow" \
            -destination "platform=iOS Simulator,name=iPhone 15,OS=latest" \
            -quiet
        # 注意：请将 "YourSchemeName" 替换为你项目真实的 Scheme 名称
